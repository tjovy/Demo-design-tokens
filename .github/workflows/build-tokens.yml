name: ðŸš€ Build Design Tokens

# DÃ‰CLENCHEUR : Quand se lance le robot ?
on:
  push:
    branches:
      - main
    # SÃ©curitÃ© : Ne se lance que si les fichiers sources (JSON) changent
    # Cela Ã©vite les boucles infinies si on modifie juste le README
    # APRÃˆS (La version qui marche Ã  tous les coups)
    paths:
      - '**.json'       # Surveille TOUS les fichiers JSON (partout)
      - 'config.json'
      - 'package.json'

# PERMISSIONS : Le robot a le droit d'Ã©crire dans le dÃ©pÃ´t
permissions:
  contents: write

jobs:
  build-and-commit:
    runs-on: ubuntu-latest
    steps:
      # 1. RÃ©cupÃ©rer le code
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      # 2. Installer Node.js
      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. Installer les dÃ©pendances (Style Dictionary)
      - name: ðŸ“¦ Install dependencies
        run: npm ci

      # 4. Lancer la construction (GÃ©nÃ©ration du CSS)
      - name: ðŸ”¨ Build Tokens
        run: npm run build

      # 5. Commit automatique du rÃ©sultat
      - name: ðŸ’¾ Commit generated files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore(tokens): ðŸ¤– Auto-generate CSS from Figma [skip ci]"
          file_pattern: 'build/**' # On ne commit que le dossier build