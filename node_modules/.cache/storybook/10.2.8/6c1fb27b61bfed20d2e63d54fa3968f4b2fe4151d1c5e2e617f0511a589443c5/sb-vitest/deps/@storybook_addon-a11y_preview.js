import {
  __export
} from "./chunk-Z7DSM4EB.js";
import {
  ElementA11yParameterError,
  addons,
  expect3,
  useCallback,
  useEffect,
  waitForAnimations
} from "./chunk-3OSEZBFG.js";
import "./chunk-RJW5SRKB.js";
import "./chunk-D3NEAM2G.js";
import {
  scope
} from "./chunk-L5P2XRAI.js";
import "./chunk-JKK7PGJG.js";
import "./chunk-7D4SUZUM.js";

// node_modules/@storybook/addon-a11y/dist/_browser-chunks/chunk-7OPMK7TU.js
var ADDON_ID = "storybook/a11y";
var PANEL_ID = `${ADDON_ID}/panel`;
var UI_STATE_ID = `${ADDON_ID}/ui`;
var RESULT = `${ADDON_ID}/result`;
var REQUEST = `${ADDON_ID}/request`;
var RUNNING = `${ADDON_ID}/running`;
var ERROR = `${ADDON_ID}/error`;
var MANUAL = `${ADDON_ID}/manual`;
var SELECT = `${ADDON_ID}/select`;
var DOCUMENTATION_LINK = "writing-tests/accessibility-testing";
var DOCUMENTATION_DISCREPANCY_LINK = `${DOCUMENTATION_LINK}#why-are-my-tests-failing-in-different-environments`;
var EVENTS = { RESULT, REQUEST, RUNNING, ERROR, MANUAL, SELECT };
var filters = {
  blurred: {
    label: "Blurred vision",
    filter: "blur(2px)",
    percentage: 22.9
  },
  deuteranomaly: {
    label: "Deuteranomaly",
    filter: 'url("#storybook-a11y-vision-deuteranomaly")',
    percentage: 2.7
  },
  deuteranopia: {
    label: "Deuteranopia",
    filter: 'url("#storybook-a11y-vision-deuteranopia")',
    percentage: 0.56
  },
  protanomaly: {
    label: "Protanomaly",
    filter: 'url("#storybook-a11y-vision-protanomaly")',
    percentage: 0.66
  },
  protanopia: {
    label: "Protanopia",
    filter: 'url("#storybook-a11y-vision-protanopia")',
    percentage: 0.59
  },
  tritanomaly: {
    label: "Tritanomaly",
    filter: 'url("#storybook-a11y-vision-tritanomaly")',
    percentage: 0.01
  },
  tritanopia: {
    label: "Tritanopia",
    filter: 'url("#storybook-a11y-vision-tritanopia")',
    percentage: 0.016
  },
  achromatopsia: {
    label: "Achromatopsia",
    filter: 'url("#storybook-a11y-vision-achromatopsia")',
    percentage: 1e-4
  },
  grayscale: {
    label: "Grayscale",
    filter: "grayscale(100%)"
  }
};
var filterDefs = `<svg id="storybook-a11y-vision-filters" style="display: none !important;">
  <defs>
    <filter id="storybook-a11y-vision-protanopia">
      <feColorMatrix
        in="SourceGraphic"
        type="matrix"
        values="0.567, 0.433, 0, 0, 0 0.558, 0.442, 0, 0, 0 0, 0.242, 0.758, 0, 0 0, 0, 0, 1, 0"
      />
    </filter>
    <filter id="storybook-a11y-vision-protanomaly">
      <feColorMatrix
        in="SourceGraphic"
        type="matrix"
        values="0.817, 0.183, 0, 0, 0 0.333, 0.667, 0, 0, 0 0, 0.125, 0.875, 0, 0 0, 0, 0, 1, 0"
      />
    </filter>
    <filter id="storybook-a11y-vision-deuteranopia">
      <feColorMatrix
        in="SourceGraphic"
        type="matrix"
        values="0.625, 0.375, 0, 0, 0 0.7, 0.3, 0, 0, 0 0, 0.3, 0.7, 0, 0 0, 0, 0, 1, 0"
      />
    </filter>
    <filter id="storybook-a11y-vision-deuteranomaly">
      <feColorMatrix
        in="SourceGraphic"
        type="matrix"
        values="0.8, 0.2, 0, 0, 0 0.258, 0.742, 0, 0, 0 0, 0.142, 0.858, 0, 0 0, 0, 0, 1, 0"
      />
    </filter>
    <filter id="storybook-a11y-vision-tritanopia">
      <feColorMatrix
        in="SourceGraphic"
        type="matrix"
        values="0.95, 0.05,  0, 0, 0 0,  0.433, 0.567, 0, 0 0,  0.475, 0.525, 0, 0 0,  0, 0, 1, 0"
      />
    </filter>
    <filter id="storybook-a11y-vision-tritanomaly">
      <feColorMatrix
        in="SourceGraphic"
        type="matrix"
        values="0.967, 0.033, 0, 0, 0 0, 0.733, 0.267, 0, 0 0, 0.183, 0.817, 0, 0 0, 0, 0, 1, 0"
      />
    </filter>
    <filter id="storybook-a11y-vision-achromatopsia">
      <feColorMatrix
        in="SourceGraphic"
        type="matrix"
        values="0.299, 0.587, 0.114, 0, 0 0.299, 0.587, 0.114, 0, 0 0.299, 0.587, 0.114, 0, 0 0, 0, 0, 1, 0"
      />
    </filter>
  </defs>
</svg>`;

// node_modules/@storybook/addon-a11y/dist/_browser-chunks/chunk-2FVV6YOY.js
var preview_exports = {};
__export(preview_exports, {
  afterEach: () => afterEach,
  decorators: () => decorators,
  initialGlobals: () => initialGlobals,
  parameters: () => parameters
});
var { document: document2 } = scope;
var withLinkPaths = (results, storyId) => {
  let pathname = document2.location.pathname.replace(/iframe\.html$/, ""), enhancedResults = { ...results };
  return ["incomplete", "passes", "violations"].forEach((key) => {
    Array.isArray(results[key]) && (enhancedResults[key] = results[key].map((result) => ({
      ...result,
      nodes: result.nodes.map((node, index) => {
        let id = `${key}.${result.id}.${index + 1}`, linkPath = `${pathname}?path=/story/${storyId}&addonPanel=${PANEL_ID}&a11ySelection=${id}`;
        return { id, ...node, linkPath };
      })
    })));
  }), enhancedResults;
};
var { document: document3 } = scope;
var channel = addons.getChannel();
var DEFAULT_PARAMETERS = { config: {}, options: {} };
var DISABLED_RULES = [
  // In component testing, landmarks are not always present
  // and the rule check can cause false positives
  "region"
];
var queue = [];
var isRunning = false;
var runNext = async () => {
  if (queue.length === 0) {
    isRunning = false;
    return;
  }
  isRunning = true;
  let next = queue.shift();
  next && await next(), runNext();
};
var run = async (input = DEFAULT_PARAMETERS, storyId) => {
  let axe = (await import("./axe-PZ4HHHCN.js"))?.default || globalThis.axe, { config = {}, options = {} } = input;
  if (input.element)
    throw new ElementA11yParameterError();
  let context = {
    include: document3?.body,
    exclude: [".sb-wrapper", "#storybook-docs", "#storybook-highlights-root"]
    // Internal Storybook elements that are always in the document
  };
  if (input.context) {
    let hasInclude = typeof input.context == "object" && "include" in input.context && input.context.include !== void 0, hasExclude = typeof input.context == "object" && "exclude" in input.context && input.context.exclude !== void 0;
    hasInclude ? context.include = input.context.include : !hasInclude && !hasExclude && (context.include = input.context), hasExclude && (context.exclude = context.exclude.concat(input.context.exclude));
  }
  axe.reset();
  let configWithDefault = {
    ...config,
    rules: [...DISABLED_RULES.map((id) => ({ id, enabled: false })), ...config?.rules ?? []]
  };
  return axe.configure(configWithDefault), new Promise((resolve, reject) => {
    let highlightsRoot = document3?.getElementById("storybook-highlights-root");
    highlightsRoot && (highlightsRoot.style.display = "none");
    let task = async () => {
      try {
        let result = await axe.run(context, options), resultWithLinks = withLinkPaths(result, storyId);
        resolve(resultWithLinks);
      } catch (error) {
        reject(error);
      }
    };
    queue.push(task), isRunning || runNext(), highlightsRoot && (highlightsRoot.style.display = "");
  });
};
channel.on(EVENTS.MANUAL, async (storyId, input = DEFAULT_PARAMETERS) => {
  try {
    await waitForAnimations();
    let result = await run(input, storyId), resultJson = JSON.parse(JSON.stringify(result));
    channel.emit(EVENTS.RESULT, resultJson, storyId);
  } catch (error) {
    channel.emit(EVENTS.ERROR, error);
  }
});
function getIsVitestStandaloneRun() {
  try {
    return import.meta.env.VITEST_STORYBOOK === "false";
  } catch {
    return false;
  }
}
var knownFilters = Object.values(filters).map((f) => f.filter);
var knownFiltersRegExp = new RegExp(`\\b(${knownFilters.join("|")})\\b`, "g");
var withVisionSimulator = (StoryFn, { globals }) => {
  let { vision } = globals, applyVisionFilter = useCallback(() => {
    let existingFilters = document.body.style.filter.replaceAll(knownFiltersRegExp, "").trim(), visionFilter = filters[vision]?.filter;
    return visionFilter && document.body.classList.contains("sb-show-main") ? !existingFilters || existingFilters === "none" ? document.body.style.filter = visionFilter : document.body.style.filter = `${existingFilters} ${visionFilter}` : document.body.style.filter = existingFilters || "none", () => document.body.style.filter = existingFilters || "none";
  }, [vision]);
  return useEffect(() => {
    let cleanup = applyVisionFilter(), observer = new MutationObserver(() => applyVisionFilter());
    return observer.observe(document.body, { attributeFilter: ["class"] }), () => {
      cleanup(), observer.disconnect();
    };
  }, [applyVisionFilter]), useEffect(() => (document.body.insertAdjacentHTML("beforeend", filterDefs), () => {
    let filterDefsElement = document.getElementById("storybook-a11y-vision-filters");
    filterDefsElement?.parentElement?.removeChild(filterDefsElement);
  }), []), StoryFn();
};
var vitestMatchersExtended = false;
var decorators = [withVisionSimulator];
var afterEach = async ({
  id: storyId,
  reporting,
  parameters: parameters2,
  globals,
  viewMode
}) => {
  let a11yParameter = parameters2.a11y, a11yGlobals = globals.a11y, shouldRunEnvironmentIndependent = !!!globals.ghostStories && a11yParameter?.disable !== true && a11yParameter?.test !== "off" && a11yGlobals?.manual !== true, getMode = () => {
    switch (a11yParameter?.test) {
      case "todo":
        return "warning";
      case "error":
      default:
        return "failed";
    }
  };
  if (shouldRunEnvironmentIndependent && viewMode === "story")
    try {
      let result = await run(a11yParameter, storyId);
      if (result) {
        let hasViolations = (result?.violations.length ?? 0) > 0;
        if (reporting.addReport({
          type: "a11y",
          version: 1,
          result,
          status: hasViolations ? getMode() : "passed"
        }), getIsVitestStandaloneRun() && hasViolations && getMode() === "failed") {
          if (!vitestMatchersExtended) {
            let { toHaveNoViolations } = await import("./matchers-5TDFFDYO-MO7U5L2B.js");
            expect3.extend({ toHaveNoViolations }), vitestMatchersExtended = true;
          }
          expect3(result).toHaveNoViolations();
        }
      }
    } catch (e) {
      if (reporting.addReport({
        type: "a11y",
        version: 1,
        result: {
          error: e
        },
        status: "failed"
      }), getIsVitestStandaloneRun())
        throw e;
    }
};
var initialGlobals = {
  a11y: {
    manual: false
  },
  vision: void 0
};
var parameters = {
  a11y: {
    test: "todo"
  }
};
export {
  afterEach,
  decorators,
  initialGlobals,
  parameters
};
//# sourceMappingURL=@storybook_addon-a11y_preview.js.map
